name: Build otoge binaries

on:
  push:
    branches:
      - 'main'
    paths:
      - '**'
      - '!data/**'

jobs:
  build:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    steps:
      - name: Checkout repository
        uses: actions/checkout@8e5e7e5ab8b370d6c329ec480221332ada57f0ab # v3

      - name: Install Rust stable
        id: rust-toolchain
        uses: actions-rs/toolchain@16499b5e05bf2e26879000db0c1d13f7e13fa3af # v1
        with:
          toolchain: stable
          profile: minimal
          override: true

      - name: Cache Cargo target directory
        uses: actions/cache@v3
        with:
          path: target
          key:
            rusttarget-${{ runner.os }}-${{ steps.rust-toolchain.outputs.rustc_hash }}-${{ github.sha }}
          restore-keys: |
            rusttarget-${{ runner.os }}-${{ steps.rust-toolchain.outputs.rustc_hash }}-
            rusttarget-${{ runner.os }}-

      - name: Build otoge
        uses: actions-rs/cargo@844f36862e911db73fe0815f00a4a2602c279505 # v1
        with:
          command: build
          args: --release
